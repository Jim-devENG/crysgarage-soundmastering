<!DOCTYPE html>
<html>
  <head>
    <title>CORS and Upload Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ccc;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        border-color: #bee5eb;
      }
      button {
        padding: 10px 20px;
        margin: 5px;
      }
      input[type="file"] {
        margin: 10px 0;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>CORS and Upload Test</h1>

    <div class="test-section info">
      <h3>Test Instructions</h3>
      <p>
        This page will test CORS functionality and file upload to your Laravel
        backend.
      </p>
      <p>Backend URL: <strong>http://localhost:8000</strong></p>
      <p>
        Frontend URL: <strong>http://localhost:3000</strong> (or your current
        port)
      </p>
    </div>

    <div class="test-section">
      <h3>1. CORS Preflight Test</h3>
      <button onclick="testCorsPreflight()">Test CORS Preflight</button>
      <div id="cors-result"></div>
    </div>

    <div class="test-section">
      <h3>2. Upload Test</h3>
      <input type="file" id="testFile" accept="audio/*" />
      <button onclick="testUpload()">Test Upload</button>
      <div id="upload-result"></div>
    </div>

    <div class="test-section">
      <h3>3. API Health Check</h3>
      <button onclick="testHealthCheck()">Test API Health</button>
      <div id="health-result"></div>
    </div>

    <div class="test-section">
      <h3>4. Authentication Test</h3>
      <button onclick="testAuth()">Test Authentication</button>
      <div id="auth-result"></div>
    </div>

    <script>
      async function testCorsPreflight() {
        const resultDiv = document.getElementById("cors-result");
        resultDiv.innerHTML = "<p>Testing CORS preflight...</p>";

        try {
          const response = await fetch("http://localhost:8000/api/health", {
            method: "OPTIONS",
            headers: {
              Origin: window.location.origin,
              "Access-Control-Request-Method": "GET",
              "Access-Control-Request-Headers": "Content-Type",
            },
          });

          const corsHeaders = {
            "Access-Control-Allow-Origin": response.headers.get(
              "Access-Control-Allow-Origin"
            ),
            "Access-Control-Allow-Methods": response.headers.get(
              "Access-Control-Allow-Methods"
            ),
            "Access-Control-Allow-Headers": response.headers.get(
              "Access-Control-Allow-Headers"
            ),
            "Access-Control-Allow-Credentials": response.headers.get(
              "Access-Control-Allow-Credentials"
            ),
          };

          resultDiv.innerHTML = `
                    <div class="success">
                        <h4>✅ CORS Preflight Successful!</h4>
                        <p>Status: ${response.status}</p>
                        <pre>${JSON.stringify(corsHeaders, null, 2)}</pre>
                    </div>
                `;
        } catch (error) {
          resultDiv.innerHTML = `
                    <div class="error">
                        <h4>❌ CORS Preflight Failed</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
        }
      }

      async function testUpload() {
        const fileInput = document.getElementById("testFile");
        const resultDiv = document.getElementById("upload-result");

        if (!fileInput.files[0]) {
          resultDiv.innerHTML =
            '<div class="error"><p>Please select a file first</p></div>';
          return;
        }

        const file = fileInput.files[0];
        const formData = new FormData();
        formData.append("audio", file);

        resultDiv.innerHTML = "<p>Uploading file...</p>";

        try {
          const response = await fetch(
            "http://localhost:8000/api/test-upload",
            {
              method: "POST",
              body: formData,
              headers: {
                Origin: window.location.origin,
              },
            }
          );

          const result = await response.text();

          if (response.ok) {
            resultDiv.innerHTML = `
                        <div class="success">
                            <h4>✅ Upload Successful!</h4>
                            <p>Status: ${response.status}</p>
                            <pre>${result}</pre>
                        </div>
                    `;
          } else {
            resultDiv.innerHTML = `
                        <div class="error">
                            <h4>❌ Upload Failed</h4>
                            <p>Status: ${response.status}</p>
                            <pre>${result}</pre>
                        </div>
                    `;
          }
        } catch (error) {
          resultDiv.innerHTML = `
                    <div class="error">
                        <h4>❌ Upload Error</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
        }
      }

      async function testHealthCheck() {
        const resultDiv = document.getElementById("health-result");
        resultDiv.innerHTML = "<p>Testing API health...</p>";

        try {
          const response = await fetch("http://localhost:8000/api/health", {
            method: "GET",
            headers: {
              Origin: window.location.origin,
            },
          });

          const result = await response.text();

          if (response.ok) {
            resultDiv.innerHTML = `
                        <div class="success">
                            <h4>✅ API Health Check Successful!</h4>
                            <p>Status: ${response.status}</p>
                            <pre>${result}</pre>
                        </div>
                    `;
          } else {
            resultDiv.innerHTML = `
                        <div class="error">
                            <h4>❌ API Health Check Failed</h4>
                            <p>Status: ${response.status}</p>
                            <pre>${result}</pre>
                        </div>
                    `;
          }
        } catch (error) {
          resultDiv.innerHTML = `
                    <div class="error">
                        <h4>❌ API Health Check Error</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
        }
      }

      async function testAuth() {
        const resultDiv = document.getElementById("auth-result");
        resultDiv.innerHTML = "<p>Testing authentication...</p>";

        try {
          const response = await fetch(
            "http://localhost:8000/api/audio/auth-test",
            {
              method: "GET",
              headers: {
                Origin: window.location.origin,
              },
            }
          );

          const result = await response.text();

          if (response.ok) {
            resultDiv.innerHTML = `
                        <div class="success">
                            <h4>✅ Authentication Test Successful!</h4>
                            <p>Status: ${response.status}</p>
                            <pre>${result}</pre>
                        </div>
                    `;
          } else {
            resultDiv.innerHTML = `
                        <div class="error">
                            <h4>❌ Authentication Test Failed</h4>
                            <p>Status: ${response.status}</p>
                            <pre>${result}</pre>
                        </div>
                    `;
          }
        } catch (error) {
          resultDiv.innerHTML = `
                    <div class="error">
                        <h4>❌ Authentication Test Error</h4>
                        <p>Error: ${error.message}</p>
                    </div>
                `;
        }
      }
    </script>
  </body>
</html>
